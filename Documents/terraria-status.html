<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ³°æ‹‰ç‘äºšæœåŠ¡å™¨çŠ¶æ€</title>
  <style>
    :root {
      --bg-color: #f5f5f5;
      --text-color: #333;
      --border-color: #ddd;
      --header-bg: #3a3a3a;
      --header-text: #fff;
      --online-color: #28a745;
      --offline-color: #dc3545;
      --panel-bg: #fff;
      --panel-shadow: rgba(0, 0, 0, 0.1);
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      background-color: var(--bg-color);
      margin: 0;
      padding: 0;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background-color: var(--header-bg);
      color: var(--header-text);
      padding: 20px 0;
      text-align: center;
      border-radius: 5px 5px 0 0;
      margin-bottom: 20px;
    }
    
    h1, h2, h3 {
      margin-top: 0;
    }
    
    .status-panel {
      background-color: var(--panel-bg);
      border-radius: 5px;
      box-shadow: 0 2px 5px var(--panel-shadow);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .server-status {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .status-indicator {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      margin-right: 10px;
    }
    
    .status-online {
      background-color: var(--online-color);
    }
    
    .status-offline {
      background-color: var(--offline-color);
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .info-item {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
    }
    
    .info-label {
      font-weight: 600;
      margin-bottom: 5px;
      color: #666;
    }
    
    .info-value {
      font-size: 18px;
      font-weight: 500;
    }
    
    .history-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    
    .history-table th,
    .history-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    .history-table th {
      background-color: #f0f0f0;
    }
    
    .history-table tr:hover {
      background-color: #f5f5f5;
    }
    
    .last-update {
      text-align: right;
      font-size: 0.9em;
      color: #666;
      font-style: italic;
      margin-top: 5px;
    }
    
    .loading {
      text-align: center;
      padding: 50px;
      font-style: italic;
      color: #666;
    }
    
    .error-message {
      background-color: #fceded;
      color: var(--offline-color);
      padding: 15px;
      border-radius: 5px;
      border: 1px solid #f8d7da;
      margin-bottom: 20px;
    }
    
    .refresh-button {
      display: inline-block;
      padding: 8px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    
    .refresh-button:hover {
      background-color: #0069d9;
    }
    
    footer {
      text-align: center;
      margin-top: 20px;
      font-size: 0.9em;
      color: #666;
    }
    
    @media (max-width: 600px) {
      .info-grid {
        grid-template-columns: 1fr;
      }
      
      .history-table thead {
        display: none;
      }
      
      .history-table, .history-table tbody, .history-table tr, .history-table td {
        display: block;
        width: 100%;
      }
      
      .history-table tr {
        margin-bottom: 15px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
      }
      
      .history-table td {
        text-align: right;
        position: relative;
        padding-left: 50%;
        border-bottom: 1px solid #eee;
      }
      
      .history-table td:before {
        content: attr(data-label);
        position: absolute;
        left: 10px;
        width: 45%;
        text-align: left;
        font-weight: bold;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>æ³°æ‹‰ç‘äºšæœåŠ¡å™¨çŠ¶æ€</h1>
    </header>
    
    <div id="loadingMessage" class="loading">
      <p>åŠ è½½æœåŠ¡å™¨çŠ¶æ€ä¸­...</p>
    </div>
    
    <div id="errorMessage" class="error-message" style="display: none;">
      <p id="errorMessageText">åŠ è½½æœåŠ¡å™¨çŠ¶æ€æ—¶å‡ºé”™ã€‚è¯·ç¨åå†è¯•ã€‚</p>
      <p>å¯èƒ½çš„åŸå› :</p>
      <ul>
        <li>GitHub APIé™åˆ¶</li>
        <li>Issueç¼–å·æˆ–ä»“åº“é…ç½®é”™è¯¯</li>
        <li>æœåŠ¡å™¨å°šæœªå‘é€çŠ¶æ€æ›´æ–°</li>
      </ul>
      <p><button id="retryButton" class="refresh-button">é‡è¯•</button></p>
    </div>
    
    <div id="statusContent" style="display: none;">
      <div class="status-panel">
        <div class="server-status">
          <div id="statusIndicator" class="status-indicator"></div>
          <h2 id="statusText">æœåŠ¡å™¨çŠ¶æ€</h2>
        </div>
        
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">å½“å‰åœ°å›¾</div>
            <div id="worldName" class="info-value">æœªçŸ¥</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">åœ¨çº¿ç©å®¶</div>
            <div id="playerCount" class="info-value">0</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">æ¨¡ç»„æ•°é‡</div>
            <div id="modCount" class="info-value">0</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">è¿è¡Œæ—¶é—´</div>
            <div id="uptimeValue" class="info-value">--</div>
          </div>
        </div>
        
        <div class="last-update">
          <button id="refreshButton" class="refresh-button">åˆ·æ–°</button>
          <span>æœ€åæ›´æ–°: <span id="lastUpdateTime">--</span></span>
        </div>
      </div>
      
      <div class="status-panel">
        <h3>æœ€è¿‘çŠ¶æ€å˜æ›´å†å²</h3>
        <div id="historyTableContainer">
          <table class="history-table">
            <thead>
              <tr>
                <th>æ—¶é—´</th>
                <th>äº‹ä»¶</th>
                <th>çŠ¶æ€</th>
                <th>ç©å®¶æ•°</th>
              </tr>
            </thead>
            <tbody id="historyTableBody">
              <!-- å†å²è®°å½•ä¼šåœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="status-panel">
        <h3>æœåŠ¡å™¨ä¿¡æ¯</h3>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">æœåŠ¡å™¨ç‰ˆæœ¬</div>
            <div id="serverVersion" class="info-value">æœªçŸ¥</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">ç½‘ç»œæ¨¡å¼</div>
            <div id="networkMode" class="info-value">Steam</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">æœ€è¿‘å¯åŠ¨æ—¶é—´</div>
            <div id="lastStartTime" class="info-value">--</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">ä¸‹æ¬¡è®¡åˆ’é‡å¯</div>
            <div id="nextRestartTime" class="info-value">--</div>
          </div>
        </div>
      </div>
    </div>
    
    <footer>
      <p>Â© 2025 æ³°æ‹‰ç‘äºšæœåŠ¡å™¨ç®¡ç†é¢æ¿ | çŠ¶æ€æ¯15åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°</p>
    </footer>
  </div>
  
  <script>
    // é…ç½®ä¿¡æ¯
    const config = {
      owner: 'wanglrebe',
      repo: 'wanglrebe.github.io', // ç¡®ä¿è¿™æ˜¯æ­£ç¡®çš„ä»“åº“å
      issueNumber: 1,  // è¯·ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„Issueç¼–å·
      refreshInterval: 5 * 60 * 1000 // 5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°
    };
    
    // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
    document.addEventListener('DOMContentLoaded', () => {
      // å°è¯•ä»GitHubè·å–æ•°æ®
      fetchServerStatus();
      
      // è®¾ç½®å®šæœŸåˆ·æ–°
      setInterval(fetchServerStatus, config.refreshInterval);
      
      // åˆ·æ–°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('refreshButton').addEventListener('click', fetchServerStatus);
      
      // é‡è¯•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('retryButton').addEventListener('click', fetchServerStatus);
      
      // æ·»åŠ ä¸€ä¸ªä¸´æ—¶æ•°æ®æŒ‰é’® - ä»…ç”¨äºæµ‹è¯•
      const tempDataBtn = document.createElement('button');
      tempDataBtn.textContent = 'ä½¿ç”¨æ¼”ç¤ºæ•°æ®';
      tempDataBtn.className = 'refresh-button';
      tempDataBtn.style.marginRight = '10px';
      tempDataBtn.addEventListener('click', () => {
        console.log('ä½¿ç”¨æ¼”ç¤ºæ•°æ®');
        const demoData = getDemoStatusData();
        updateStatusDisplay(demoData);
        showContent();
      });
      
      // å°†æŒ‰é’®æ’å…¥åˆ°åˆ·æ–°æŒ‰é’®å‰é¢
      const refreshButton = document.getElementById('refreshButton');
      refreshButton.parentNode.insertBefore(tempDataBtn, refreshButton);
    });
    
    /**
     * è·å–æ¼”ç¤ºçŠ¶æ€æ•°æ®
     * @returns {Object} æ¼”ç¤ºçŠ¶æ€æ•°æ®
     */
    function getDemoStatusData() {
      const now = new Date();
      const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
      const twoHoursAgo = new Date(now.getTime() - 2 * 60 * 60 * 1000);
      
      return {
        currentStatus: {
          running: true,
          playerCount: 3,
          worldName: "MyTerrariaWorld",
          modCount: 15,
          serverVersion: "tModLoader v2023.x",
          uptime: 7200, // 2å°æ—¶
          lastUpdate: now.toISOString()
        },
        history: [
          {
            timestamp: now.toISOString(),
            reason: "å®šæ—¶æ›´æ–°",
            status: {
              running: true,
              playerCount: 3,
              worldName: "MyTerrariaWorld",
              modCount: 15,
              uptime: 7200
            }
          },
          {
            timestamp: oneHourAgo.toISOString(),
            reason: "ç©å®¶æ•°é‡å˜åŒ–",
            status: {
              running: true,
              playerCount: 2,
              worldName: "MyTerrariaWorld",
              modCount: 15,
              uptime: 3600
            }
          },
          {
            timestamp: twoHoursAgo.toISOString(),
            reason: "æœåŠ¡å™¨å¯åŠ¨",
            status: {
              running: true,
              playerCount: 0,
              worldName: "MyTerrariaWorld",
              modCount: 15,
              uptime: 0
            }
          }
        ]
      };
    }
    
    /**
     * è·å–æœåŠ¡å™¨çŠ¶æ€
     */
    async function fetchServerStatus() {
      showLoading(true);
      
      try {
        // ç›´æ¥è·å–Issueé¡µé¢HTMLè€Œä¸æ˜¯ä½¿ç”¨API
        const issueUrl = `https://github.com/${config.owner}/${config.repo}/issues/${config.issueNumber}`;
        console.log(`æ­£åœ¨è¯·æ±‚é¡µé¢: ${issueUrl}`);
        
        // ä½¿ç”¨CORSä»£ç†æ¥è·å–GitHubé¡µé¢
        // æ³¨æ„ï¼šåœ¨å®é™…éƒ¨ç½²å‰éœ€è¦æ›¿æ¢ä¸ºå¯é çš„CORSä»£ç†
        const corsProxyUrl = `https://corsproxy.io/?${encodeURIComponent(issueUrl)}`;
        
        const response = await fetch(corsProxyUrl);
        
        if (!response.ok) {
          throw new Error(`è·å–Issueé¡µé¢å¤±è´¥: ${response.status}`);
        }
        
        const htmlContent = await response.text();
        console.log('æˆåŠŸè·å–Issueé¡µé¢å†…å®¹');
        
        // æ£€æŸ¥å“åº”HTMLå†…å®¹çš„ä¸€å°éƒ¨åˆ†ï¼Œå¸®åŠ©è°ƒè¯•
        const htmlPreview = htmlContent.substring(0, 200) + '...';
        console.log('HTMLé¢„è§ˆ:', htmlPreview);
        
        // æ£€æŸ¥HTMLä¸­æ˜¯å¦åŒ…å«å…³é”®å­—ï¼Œå¸®åŠ©ç†è§£é¡µé¢å†…å®¹
        const hasJsonBlock = htmlContent.includes('```json');
        const hasPreTag = htmlContent.includes('<pre>');
        const hasCodeTag = htmlContent.includes('<code>');
        const hasCommentBody = htmlContent.includes('js-comment-body');
        const hasMarkdownBody = htmlContent.includes('markdown-body');
        
        console.log('é¡µé¢å†…å®¹æ£€æŸ¥:', {
          hasJsonBlock,
          hasPreTag,
          hasCodeTag,
          hasCommentBody,
          hasMarkdownBody
        });
        
        // æ£€æŸ¥é¡µé¢ä¸­çš„ä»£ç å—æ•°é‡
        const preCount = (htmlContent.match(/<pre/g) || []).length;
        const codeCount = (htmlContent.match(/<code/g) || []).length;
        console.log(`é¡µé¢ä¸­åŒ…å« ${preCount} ä¸ª<pre>æ ‡ç­¾å’Œ ${codeCount} ä¸ª<code>æ ‡ç­¾`);
        
        // ä»HTMLä¸­æå–JSONæ•°æ®
        const statusData = extractDataFromHtml(htmlContent);
        
        if (statusData) {
          console.log('æˆåŠŸæå–çŠ¶æ€æ•°æ®:', statusData);
          updateStatusDisplay(statusData);
          showContent();
        } else {
          throw new Error('æ— æ³•ä»é¡µé¢ä¸­æå–çŠ¶æ€æ•°æ®');
        }
      } catch (error) {
        console.error('è·å–æœåŠ¡å™¨çŠ¶æ€å¤±è´¥:', error);
        showError(error.message);
      }
    }
    
    /**
     * ä»HTMLå†…å®¹ä¸­æå–çŠ¶æ€æ•°æ®
     * @param {string} html - Issueé¡µé¢çš„HTMLå†…å®¹
     * @returns {Object|null} è§£æå‡ºçš„çŠ¶æ€æ•°æ®æˆ–null
     */
    function extractDataFromHtml(html) {
      try {
        console.log('å¼€å§‹ä»HTMLä¸­æå–æ•°æ®...');
        
        // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„DOMè§£æå™¨
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // å°è¯•ä»metaæ ‡ç­¾ä¸­è·å–ä¿¡æ¯
        console.log('å°è¯•ä»metaæ ‡ç­¾ä¸­æå–ä¿¡æ¯...');
        const metaDescription = doc.querySelector('meta[property="og:description"]') || 
                              doc.querySelector('meta[name="description"]');
        
        if (metaDescription) {
          const content = metaDescription.getAttribute('content');
          console.log('æ‰¾åˆ°metaæè¿°:', content.substring(0, 100) + '...');
          
          // å°è¯•ä»metaæè¿°ä¸­æå–çŠ¶æ€ä¿¡æ¯
          const currentStatus = {
            running: content.includes('ğŸŸ¢ è¿è¡Œä¸­'),
            playerCount: 0,
            worldName: 'æœªçŸ¥',
            modCount: 0,
            serverVersion: 'æœªçŸ¥',
            lastUpdate: new Date().toISOString()
          };
          
          // å°è¯•æå–ç©å®¶æ•°é‡
          const playerMatch = content.match(/åœ¨çº¿ç©å®¶[:ï¼š]\s*(\d+)/);
          if (playerMatch && playerMatch[1]) {
            currentStatus.playerCount = parseInt(playerMatch[1], 10);
            console.log('æ‰¾åˆ°ç©å®¶æ•°é‡:', currentStatus.playerCount);
          }
          
          // å°è¯•æå–ä¸–ç•Œåç§°
          const worldMatch = content.match(/ä¸–ç•Œåç§°[:ï¼š]\s*([^åœ¨\n]+)/);
          if (worldMatch && worldMatch[1]) {
            currentStatus.worldName = worldMatch[1].trim();
            console.log('æ‰¾åˆ°ä¸–ç•Œåç§°:', currentStatus.worldName);
          }
          
          // å°è¯•æå–æ¨¡ç»„æ•°é‡
          const modMatch = content.match(/æ¨¡ç»„æ•°é‡[:ï¼š]\s*(\d+)/);
          if (modMatch && modMatch[1]) {
            currentStatus.modCount = parseInt(modMatch[1], 10);
            console.log('æ‰¾åˆ°æ¨¡ç»„æ•°é‡:', currentStatus.modCount);
          }
          
          // å°è¯•æå–æœåŠ¡å™¨ç‰ˆæœ¬
          const versionMatch = content.match(/æœåŠ¡å™¨ç‰ˆæœ¬[:ï¼š]\s*([^è¿\n]+)/);
          if (versionMatch && versionMatch[1]) {
            currentStatus.serverVersion = versionMatch[1].trim();
            console.log('æ‰¾åˆ°æœåŠ¡å™¨ç‰ˆæœ¬:', currentStatus.serverVersion);
          }
          
          // å°è¯•æå–æœ€åæ›´æ–°æ—¶é—´
          const updateMatch = content.match(/æœ€åæ›´æ–°[:ï¼š]\s*([^å½“\n]+)/);
          if (updateMatch && updateMatch[1]) {
            try {
              currentStatus.lastUpdate = new Date(updateMatch[1].trim()).toISOString();
              console.log('æ‰¾åˆ°æœ€åæ›´æ–°æ—¶é—´:', currentStatus.lastUpdate);
            } catch (e) {
              console.log('è§£ææ—¶é—´å¤±è´¥, ä½¿ç”¨å½“å‰æ—¶é—´');
            }
          }
          
          // å°è¯•æå–è¿è¡Œæ—¶é—´
          const uptimeMatch = content.match(/è¿è¡Œæ—¶é—´[:ï¼š]\s*(\d+)å°æ—¶(\d+)åˆ†é’Ÿ/);
          if (uptimeMatch && uptimeMatch[1] && uptimeMatch[2]) {
            const hours = parseInt(uptimeMatch[1], 10);
            const minutes = parseInt(uptimeMatch[2], 10);
            currentStatus.uptime = (hours * 3600) + (minutes * 60);
            console.log('æ‰¾åˆ°è¿è¡Œæ—¶é—´:', currentStatus.uptime, 'ç§’');
          }
          
          // å°è¯•è§£æå†å²è®°å½•
          const history = [];
          
          // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰å†å²è®°å½•è¡Œ
          // æ ¼å¼ç±»ä¼¼äº "2025/4/7 01:25:43 æœåŠ¡å™¨å¯åŠ¨ ğŸŸ¢ è¿è¡Œä¸­ 0"
          const historyRegex = /(\d{4}\/\d{1,2}\/\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2})\s+([^\s]+)\s+(ğŸŸ¢ è¿è¡Œä¸­|ğŸ”´ ç¦»çº¿)\s+(\d+)/g;
          let match;
          
          while ((match = historyRegex.exec(content)) !== null) {
            try {
              const timestamp = new Date(match[1]).toISOString();
              const reason = match[2];
              const running = match[3].includes('è¿è¡Œä¸­');
              const playerCount = parseInt(match[4], 10);
              
              history.push({
                timestamp,
                reason,
                status: {
                  running,
                  playerCount,
                  worldName: currentStatus.worldName,
                  modCount: currentStatus.modCount
                }
              });
              
              console.log('æ‰¾åˆ°å†å²è®°å½•:', match[1], reason);
            } catch (e) {
              console.error('è§£æå†å²è®°å½•å¤±è´¥:', e);
            }
          }
          
          // åè½¬å†å²è®°å½•ï¼Œä½¿æœ€æ–°çš„åœ¨å‰é¢
          history.reverse();
          
          console.log(`æå–å®Œæˆï¼Œæ‰¾åˆ° ${history.length} æ¡å†å²è®°å½•`);
          
          // å°è¯•ä»JSONéƒ¨åˆ†è§£æå®Œæ•´æ•°æ®
          try {
            const jsonMatch = content.match(/è¯¦ç»†çŠ¶æ€æ•°æ® \(JSON\)([\s\S]*?)(\{.*\})/);
            if (jsonMatch && jsonMatch[2]) {
              const jsonText = jsonMatch[2].replace(/&quot;/g, '"');
              console.log('æ‰¾åˆ°JSONæ•°æ®:', jsonText.substring(0, 100) + '...');
              
              try {
                const jsonData = JSON.parse(jsonText);
                console.log('æˆåŠŸè§£æJSONæ•°æ®');
                return jsonData;
              } catch (e) {
                console.error('JSONè§£æå¤±è´¥:', e);
                // ç»§ç»­ä½¿ç”¨ä»metaæå–çš„æ•°æ®
              }
            }
          } catch (e) {
            console.error('æå–JSONå¤±è´¥:', e);
          }
          
          return {
            currentStatus,
            history: history.length > 0 ? history : []
          };
        } else {
          console.log('æœªæ‰¾åˆ°metaæè¿°æ ‡ç­¾ï¼Œå°è¯•å…¶ä»–æ–¹æ³•...');
        }
        
        console.log('ä»é¡µé¢æ— æ³•æå–æœ‰æ•ˆæ•°æ®ï¼Œè¿”å›åŸºæœ¬çŠ¶æ€');
        // å¦‚æœæ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥ï¼Œè¿”å›ä¸€ä¸ªåŸºæœ¬çŠ¶æ€
        return {
          currentStatus: {
            running: false,
            playerCount: 0,
            worldName: 'æœªçŸ¥',
            modCount: 0,
            serverVersion: 'æœªçŸ¥',
            lastUpdate: new Date().toISOString(),
            uptime: null
          },
          history: []
        };
      } catch (error) {
        console.error('ä»HTMLä¸­æå–æ•°æ®å¤±è´¥:', error);
        return null;
      }
    }
    

    
    /**
     * æ›´æ–°çŠ¶æ€æ˜¾ç¤º
     * @param {Object} data - çŠ¶æ€æ•°æ®
     */
    function updateStatusDisplay(data) {
      const { currentStatus, history } = data;
      
      // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
      const statusIndicator = document.getElementById('statusIndicator');
      const statusText = document.getElementById('statusText');
      
      if (currentStatus.running) {
        statusIndicator.className = 'status-indicator status-online';
        statusText.textContent = 'æœåŠ¡å™¨åœ¨çº¿';
      } else {
        statusIndicator.className = 'status-indicator status-offline';
        statusText.textContent = 'æœåŠ¡å™¨ç¦»çº¿';
      }
      
      // æ›´æ–°åŸºæœ¬ä¿¡æ¯
      document.getElementById('worldName').textContent = currentStatus.worldName || 'æœªçŸ¥';
      document.getElementById('playerCount').textContent = currentStatus.playerCount;
      document.getElementById('modCount').textContent = currentStatus.modCount;
      document.getElementById('serverVersion').textContent = currentStatus.serverVersion || 'æœªçŸ¥';
      
      // æ ¼å¼åŒ–è¿è¡Œæ—¶é—´
      if (currentStatus.uptime !== null) {
        const hours = Math.floor(currentStatus.uptime / 3600);
        const minutes = Math.floor((currentStatus.uptime % 3600) / 60);
        document.getElementById('uptimeValue').textContent = `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
      } else {
        document.getElementById('uptimeValue').textContent = '--';
      }
      
      // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
      const lastUpdate = new Date(currentStatus.lastUpdate);
      document.getElementById('lastUpdateTime').textContent = lastUpdate.toLocaleString();
      
      // æŸ¥æ‰¾æœ€è¿‘çš„æœåŠ¡å™¨å¯åŠ¨æ—¶é—´
      if (history && history.length > 0) {
        // å¯»æ‰¾æœ€è¿‘çš„æœåŠ¡å™¨å¯åŠ¨äº‹ä»¶
        const startEvent = [...history].reverse().find(item => 
          item.reason === 'æœåŠ¡å™¨å¯åŠ¨' && item.status.running === true
        );
        
        if (startEvent) {
          const startTime = new Date(startEvent.timestamp);
          document.getElementById('lastStartTime').textContent = startTime.toLocaleString();
        }
        
        // å¯ä»¥ä»çŠ¶æ€å†å²ä¸­æå–å…¶ä»–ä¿¡æ¯ï¼Œå¦‚ç½‘ç»œæ¨¡å¼ç­‰
        // è¿™é‡Œä»…ä½œç¤ºä¾‹
        document.getElementById('networkMode').textContent = 'Steam';
        document.getElementById('nextRestartTime').textContent = 'æœªè®¡åˆ’';
      }
      
      // æ›´æ–°å†å²è®°å½•è¡¨æ ¼
      updateHistoryTable(history);
    }
    
    /**
     * æ›´æ–°å†å²è®°å½•è¡¨æ ¼
     * @param {Array} history - å†å²è®°å½•æ•°ç»„
     */
    function updateHistoryTable(history) {
      const tableBody = document.getElementById('historyTableBody');
      tableBody.innerHTML = '';
      
      if (!history || history.length === 0) {
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.colSpan = 4;
        cell.textContent = 'æš‚æ— å†å²è®°å½•';
        cell.style.textAlign = 'center';
        row.appendChild(cell);
        tableBody.appendChild(row);
        return;
      }
      
      // å–æœ€è¿‘çš„10æ¡è®°å½•
      const recentHistory = history.slice(-10).reverse();
      
      recentHistory.forEach(item => {
        const row = document.createElement('tr');
        
        // æ—¶é—´åˆ—
        const timeCell = document.createElement('td');
        timeCell.setAttribute('data-label', 'æ—¶é—´');
        const time = new Date(item.timestamp).toLocaleString();
        timeCell.textContent = time;
        row.appendChild(timeCell);
        
        // äº‹ä»¶åˆ—
        const eventCell = document.createElement('td');
        eventCell.setAttribute('data-label', 'äº‹ä»¶');
        eventCell.textContent = item.reason;
        row.appendChild(eventCell);
        
        // çŠ¶æ€åˆ—
        const statusCell = document.createElement('td');
        statusCell.setAttribute('data-label', 'çŠ¶æ€');
        statusCell.textContent = item.status.running ? 'åœ¨çº¿' : 'ç¦»çº¿';
        row.appendChild(statusCell);
        
        // ç©å®¶æ•°åˆ—
        const playerCell = document.createElement('td');
        playerCell.setAttribute('data-label', 'ç©å®¶æ•°');
        playerCell.textContent = item.status.playerCount;
        row.appendChild(playerCell);
        
        tableBody.appendChild(row);
      });
    }
    
    /**
     * æ˜¾ç¤º/éšè—åŠ è½½ä¿¡æ¯
     * @param {boolean} show - æ˜¯å¦æ˜¾ç¤º
     */
    function showLoading(show) {
      document.getElementById('loadingMessage').style.display = show ? 'block' : 'none';
      if (show) {
        document.getElementById('errorMessage').style.display = 'none';
      }
    }
    
    /**
     * æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
     * @param {string} message - é”™è¯¯æ¶ˆæ¯
     */
    function showError(message = 'åŠ è½½æœåŠ¡å™¨çŠ¶æ€æ—¶å‡ºé”™ã€‚è¯·ç¨åå†è¯•ã€‚') {
      document.getElementById('loadingMessage').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'block';
      document.getElementById('errorMessageText').textContent = message;
      document.getElementById('statusContent').style.display = 'none';
      
      // ç¡®ä¿é‡è¯•æŒ‰é’®æœ‰æ­£ç¡®çš„ç›‘å¬å™¨
      document.getElementById('retryButton').addEventListener('click', fetchServerStatus);
    }
    
    /**
     * æ˜¾ç¤ºå†…å®¹
     */
    function showContent() {
      document.getElementById('loadingMessage').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'none';
      document.getElementById('statusContent').style.display = 'block';
    }
  </script>
</body>
</html>
